import{l as _,r as T,j as e,B as b,t as u,d as R}from"./index-Bso-p6jD.js";import{d as k,e as z,u as K,D as L,a as O,b as B,c as G,m as U,T as X,f as q,g as C,h as J,i as A,j as Q,k as N,l as W}from"./dialog-DxXAEMp1.js";import{c as Y}from"./react-ZjbKzo2G.js";import{t as Z,F as H,a as p,b as x,c as j,d as f,e as y,o as ee,s as E,f as F}from"./form-BkrWHc7A.js";import{u as ae}from"./index.esm-BWhnKIRv.js";import{I as M}from"./createLucideIcon-BJ1hQVL1.js";import{S as w,a as v,b as D,c as P,T as V,f as S,D as $}from"./select-CQID0N0p.js";import{u as re}from"./useHorariosStore-AJIGBk7K.js";import{u as se,A as oe,a as ne,b as te,c as ie,d as le,e as ce,f as de,g as he,h as me}from"./alert-dialog-CA50szMp.js";import{P as ue}from"./plus-lqA38RdY.js";import"./index-DQwDRUDg.js";const ge=async()=>{var s,n,r,t;try{return(await _.get("client/pagos")).data.data}catch(a){const i=a,l=((n=(s=i.response)==null?void 0:s.data)==null?void 0:n.message)??"Error inesperado",d=(t=(r=i.response)==null?void 0:r.data)==null?void 0:t.errors;throw{message:l,validationErrors:d}}},pe=async s=>{var n,r,t,a;try{return(await _.post("client/pago",s)).data}catch(i){const l=i,d=((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.message)??"Error inesperado",c=(a=(t=l.response)==null?void 0:t.data)==null?void 0:a.errors;throw{message:d,validationErrors:c}}},xe=async(s,n)=>{var r,t,a,i;try{return(await _.patch(`client/pago/${s}`,n)).data}catch(l){const d=l,c=((t=(r=d.response)==null?void 0:r.data)==null?void 0:t.message)??"Error inesperado",m=(i=(a=d.response)==null?void 0:a.data)==null?void 0:i.errors;throw{message:c,validationErrors:m}}},je=async s=>{var n,r,t,a;try{return(await _.delete(`client/pago/${s}`)).data}catch(i){const l=i,d=((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.message)??"Error inesperado",c=(a=(t=l.response)==null?void 0:t.data)==null?void 0:a.errors;throw{message:d,validationErrors:c}}},I=Y((s,n)=>({pagos:[],selectedPago:null,loading:!1,error:null,fetchPagos:async()=>{s({loading:!0,error:null});try{const r=await ge();s({pagos:r})}catch(r){s({error:r.message||"Error al cargar pagos"})}finally{s({loading:!1})}},createPago:async r=>{await pe(r),await n().fetchPagos()},updatePago:async(r,t)=>{await xe(r,t),await n().fetchPagos()},deletePago:async r=>{await je(r),await n().fetchPagos()},selectPago:r=>{s({selectedPago:r})}})),fe=ee({tipo_grupo:F(V),dia_semana:F($),hora_inicio:E().min(1,{message:"La hora de inicio es obligatoria"}),hora_fin:E().min(1,{message:"La hora de fin es obligatoria"}),sede_id:E().min(1,{message:"La dirección de la horario es obligatoria"})}).refine(s=>{const[n,r]=s.hora_inicio.split(":").map(Number),[t,a]=s.hora_fin.split(":").map(Number),i=n*60+r;return t*60+a>i},{message:"La hora de fin debe ser posterior a la hora de inicio",path:["hora_fin"]});function ye({setIsModalOpen:s}){const{sedes:n,fetchSedes:r}=se(),{selectHorario:t,selectedHorario:a,createHorario:i,updateHorario:l,deleteHorario:d}=re();T.useEffect(()=>{n.length===0&&r()},[]);const c=ae({resolver:Z(fe),defaultValues:{tipo_grupo:`${(a==null?void 0:a.tipo_grupo)??""}`,dia_semana:`${(a==null?void 0:a.dia_semana)??""}`,hora_inicio:`${(a==null?void 0:a.hora_inicio)??"07:00:00"}`,hora_fin:`${(a==null?void 0:a.hora_fin)??"08:00:00"}`,sede_id:`${(a==null?void 0:a.sede_id)??""}`}}),m=async o=>{if(a!=null&&a.id)try{await l(a.id,o),u.success("El horario fue actualizado correctamente."),t(null),s(!1)}catch(h){u.error("No se pudo actualizar el horario. Intenta de nuevo."),console.error("Error al actualizar",h)}else try{await i(o),u.success("El horario fue registrado correctamente."),t(null),s(!1)}catch(h){u.error("No se pudo registrar el horario. Intenta de nuevo."),console.error("Error al registrar",h)}};return e.jsx(H,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(m),className:"space-y-4",children:[e.jsx(p,{control:c.control,name:"tipo_grupo",render:({field:o})=>e.jsxs(x,{children:[e.jsx(j,{children:"Grupo"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(f,{children:e.jsx(v,{children:e.jsx(D,{placeholder:"Tipos de grupo"})})}),e.jsx(P,{children:V.map((h,g)=>e.jsx(S,{value:h,children:h},g))})]}),e.jsx(y,{})]})}),e.jsx(p,{control:c.control,name:"dia_semana",render:({field:o})=>e.jsxs(x,{children:[e.jsx(j,{children:"Día"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(f,{children:e.jsx(v,{children:e.jsx(D,{placeholder:"Opciones de días"})})}),e.jsx(P,{children:$.map((h,g)=>e.jsx(S,{value:h,children:h},g))})]}),e.jsx(y,{})]})}),e.jsx(p,{control:c.control,name:"sede_id",render:({field:o})=>e.jsxs(x,{children:[e.jsx(j,{children:"Sede"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(f,{children:e.jsx(v,{children:e.jsx(D,{placeholder:"Opciones de sedes"})})}),e.jsx(P,{children:n.map((h,g)=>e.jsx(S,{value:h.id.toString(),children:h.nombre},g))})]}),e.jsx(y,{})]})}),e.jsx(p,{control:c.control,name:"hora_inicio",render:({field:o})=>e.jsxs(x,{children:[e.jsx(j,{children:"Hora de inicio"}),e.jsx(f,{children:e.jsx(M,{...o,type:"time",id:"time-picker",step:"1"})}),e.jsx(y,{})]})}),e.jsx(p,{control:c.control,name:"hora_fin",render:({field:o})=>e.jsxs(x,{children:[e.jsx(j,{children:"Hora de fin"}),e.jsx(f,{children:e.jsx(M,{...o,type:"time",id:"time-picker",step:"1"})}),e.jsx(y,{})]})}),e.jsxs(k,{children:[e.jsx(z,{asChild:!0,children:e.jsx(b,{variant:"outline",children:"Cancelar"})}),e.jsx(b,{type:"submit",children:a?"Actualizar":"Agregar"}),e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:a&&e.jsx(b,{variant:"destructive",children:"Eliminar"})}),e.jsxs(te,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:"¿Estás seguro?"}),e.jsx(ce,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(de,{children:[e.jsx(he,{children:"Cancelar"}),e.jsx(me,{onClick:async()=>{if(a!=null&&a.id)try{await d(a.id),u.success("La sede fue eliminada correctamente."),t(null),s(!1)}catch(o){u.error("No se pudo eliminar la sede. Intenta de nuevo."),console.error("Error al eliminar",o)}},children:"Confirmar"})]})]})]})]})]})})}function be({columns:s,data:n}){var c;const r=K({data:n,columns:s,getCoreRowModel:W(),manualPagination:!0}),[t,a]=T.useState(!1),{selectedPago:i,selectPago:l}=I(),d={setIsModalOpen:a};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Pagos"}),e.jsx(b,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{l(null),a(!0)},children:e.jsx(ue,{})}),e.jsxs("div",{className:"rounded-md border",children:[t&&e.jsx(L,{open:t,onOpenChange:a,children:e.jsxs(O,{children:[e.jsxs(B,{children:[e.jsx(G,{children:i?"Editar Pago":"Agregar Pago"}),e.jsx(U,{children:i?"Modifica los datos del pago y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo pago en el sistema."})]}),e.jsx(ye,{...d})]})}),e.jsxs(X,{children:[e.jsx(q,{children:r.getHeaderGroups().map(m=>e.jsx(C,{children:m.headers.map(o=>e.jsx(J,{children:o.isPlaceholder?null:A(o.column.columnDef.header,o.getContext())},o.id))},m.id))}),e.jsx(Q,{className:"text-gray-600",children:(c=r.getRowModel().rows)!=null&&c.length?r.getRowModel().rows.map(m=>e.jsx(C,{onClick:()=>{l(m.original),a(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:m.getVisibleCells().map(o=>e.jsx(N,{className:"py-0.5",children:A(o.column.columnDef.cell,o.getContext())},o.id))},m.id)):e.jsx(C,{children:e.jsx(N,{colSpan:s.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const _e=[{accessorKey:"id",header:"#",cell:({row:s})=>s.index+1},{accessorKey:"monto",header:"Monto"},{accessorKey:"fecha_pago",header:"Fecha"},{accessorKey:"metodo_pago",header:"Metodo de pago"},{accessorKey:"numero_referencia_pago",header:"Número de referencia"},{accessorKey:"soporte_pago",header:"Soporte de pago"},{accessorKey:"estudiante",header:"Estudiante"}];R.defaults.withCredentials=!0;R.defaults.withXSRFToken=!0;function Me(){const{pagos:s,fetchPagos:n}=I();return T.useEffect(()=>{n()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(be,{data:s,columns:_e})})}export{Me as default};
