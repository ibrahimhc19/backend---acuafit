import{r as v,j as e,B as f,t,i as _}from"./index-CBYVabO5.js";import{d as N,e as T,u as S,P as A,D as E,a as P,b as w,c as M,m as R,T as K,f as z,g as y,h as H,i as D,j as k,k as C,l as q}from"./dialog-DIBts8lj.js";import{u as F}from"./usePagosStore-BBDwCuiw.js";import{u as L,t as B,F as I,a as m,b as u,c as h,e as g,o as O,s as l,g as V,n as X}from"./form-CU9axlj2.js";import{u as $}from"./index.esm-Ddviz_xR.js";import{u as G}from"./useHorariosStore-CB_4Y6Ut.js";import{A as J,a as Q,b as U,c as W,d as Y,e as Z,f as ee,g as ae,h as re}from"./alert-dialog-Bx_YTCjP.js";import"./createLucideIcon-DHwrj6jn.js";import"./react-Cbco6HJ_.js";const oe=O({factura_id:l({required_error:"Factura no válida"}),fecha_pago:l({required_error:"La fecha de pago es obligatoria"}).refine(r=>!isNaN(Date.parse(r)),"Fecha inválida"),monto_abono:V([l().regex(/^\d+(\.\d{1,2})?$/,"Debe ser un número válido"),X()]).transform(r=>Number(r)).refine(r=>r>0,"El monto debe ser mayor que cero"),medio_pago:l({required_error:"Selecciona un medio de pago"}).min(1,"Selecciona un medio de pago"),comprobante:l().optional(),observaciones:l().optional()});function se({setIsModalOpen:r}){const{sedes:c,fetchSedes:d}=L(),{selectHorario:i,selectedHorario:o,createHorario:x,updateHorario:p,deleteHorario:j}=G();v.useEffect(()=>{c.length===0&&d()},[]);const s=$({resolver:B(oe),defaultValues:{fecha_pago:"",medio_pago:"",monto_abono:0,comprobante:"",observaciones:""}}),n=async a=>{if(o!=null&&o.id)try{await p(o.id,a),t.success("El horario fue actualizado correctamente."),i(null),r(!1)}catch(b){t.error("No se pudo actualizar el horario. Intenta de nuevo."),console.error("Error al actualizar",b)}else try{await x(a),t.success("El horario fue registrado correctamente."),i(null),r(!1)}catch(b){t.error("No se pudo registrar el horario. Intenta de nuevo."),console.error("Error al registrar",b)}};return e.jsx(I,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(n),className:"space-y-4",children:[e.jsx(m,{control:s.control,name:"fecha_pago",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Fecha de pago"}),e.jsx(g,{})]})}),e.jsx(m,{control:s.control,name:"monto_abono",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Monto abonado"}),e.jsx(g,{})]})}),e.jsx(m,{control:s.control,name:"medio_pago",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Medio de pago"}),e.jsx(g,{})]})}),e.jsx(m,{control:s.control,name:"comprobante",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Comprobante o referencia"}),e.jsx(g,{})]})}),e.jsx(m,{control:s.control,name:"observaciones",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Observaciones"}),e.jsx(g,{})]})}),e.jsxs(N,{children:[e.jsx(T,{asChild:!0,children:e.jsx(f,{variant:"outline",children:"Cancelar"})}),e.jsx(f,{type:"submit",children:o?"Actualizar":"Agregar"}),e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,children:o&&e.jsx(f,{variant:"destructive",children:"Eliminar"})}),e.jsxs(U,{children:[e.jsxs(W,{children:[e.jsx(Y,{children:"¿Estás seguro?"}),e.jsx(Z,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(ee,{children:[e.jsx(ae,{children:"Cancelar"}),e.jsx(re,{onClick:async()=>{if(o!=null&&o.id)try{await j(o.id),t.success("La sede fue eliminada correctamente."),i(null),r(!1)}catch(a){t.error("No se pudo eliminar la sede. Intenta de nuevo."),console.error("Error al eliminar",a)}},children:"Confirmar"})]})]})]})]})]})})}function ne({columns:r,data:c}){var s;const d=S({data:c,columns:r,getCoreRowModel:q(),manualPagination:!0}),[i,o]=v.useState(!1),{selectedPago:x,selectPago:p}=F(),j={setIsModalOpen:o};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Pagos"}),e.jsx(f,{variant:"outline",size:"sm",disabled:!0,className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{p(null),o(!0)},children:e.jsx(A,{})}),e.jsxs("div",{className:"rounded-md border",children:[i&&e.jsx(E,{open:i,onOpenChange:o,children:e.jsxs(P,{children:[e.jsxs(w,{children:[e.jsx(M,{children:x?"Editar Pago":"Agregar Pago"}),e.jsx(R,{children:x?"Modifica los datos del pago y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo pago en el sistema."})]}),e.jsx(se,{...j})]})}),e.jsxs(K,{children:[e.jsx(z,{children:d.getHeaderGroups().map(n=>e.jsx(y,{children:n.headers.map(a=>e.jsx(H,{children:a.isPlaceholder?null:D(a.column.columnDef.header,a.getContext())},a.id))},n.id))}),e.jsx(k,{className:"text-gray-600",children:(s=d.getRowModel().rows)!=null&&s.length?d.getRowModel().rows.map(n=>e.jsx(y,{onClick:()=>{p(n.original),o(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:n.getVisibleCells().map(a=>e.jsx(C,{className:"py-0.5",children:D(a.column.columnDef.cell,a.getContext())},a.id))},n.id)):e.jsx(y,{children:e.jsx(C,{colSpan:r.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const ie=[{accessorKey:"id",header:"#",cell:({row:r})=>r.index+1},{accessorKey:"facturacion_id",header:"Factura"},{accessorKey:"monto",header:"Monto del pago"},{accessorKey:"fecha_pago",header:"Fecha de pago"},{accessorKey:"metodo_pago",header:"Número de referencia"},{accessorKey:"numero_referencia_pago",header:"Medio de pago"},{accessorKey:"soporte_pago",header:"Soporte de pago"},{accessorKey:"observaciones",header:"Observaciones"}];_.defaults.withCredentials=!0;_.defaults.withXSRFToken=!0;function pe(){const{pagos:r,fetchPagos:c}=F();return v.useEffect(()=>{c()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(ne,{data:r,columns:ie})})}export{pe as default};
