import{r as v,j as e,B as g,t as u}from"./index-BdtfmXjO.js";import{d as T,e as E,A as S,f as A,g as K,h as w,i as P,j as R,k as z,l as H,m as M,u as q,P as V,D as k,a as I,b as L,c as B,v as O,T as $,n as G,o as b,p as J,q as D,r as Q,s as _,t as U}from"./alert-dialog-BSKuAh2R.js";import{u as N}from"./usePagosStore-B-mErAn1.js";import{u as W,t as X,F as Y,a as t,b as i,c,e as l,o as Z,s as d,g as C,n as F}from"./form-CBwiVxpK.js";import{u as ee}from"./index.esm-BZUCZitZ.js";import{u as re}from"./useHorariosStore-kMeI5T36.js";import"./react-CCkzm1Ew.js";const ae=Z({estudiante_id:d({required_error:"Selecciona un estudiante"}),concepto:d({required_error:"Selecciona un concepto"}).min(1,"El concepto no puede estar vacío"),valor_matricula:C([d().regex(/^\d+(\.\d{1,2})?$/,"Debe ser un número válido"),F()]).transform(r=>Number(r)||0).optional(),monto_total:C([d().regex(/^\d+(\.\d{1,2})?$/,"Debe ser un número válido"),F()]).transform(r=>Number(r)).refine(r=>r>0,"El monto total debe ser mayor que cero"),fecha_emision:d({required_error:"La fecha de emisión es obligatoria"}).refine(r=>!isNaN(Date.parse(r)),"Fecha no válida"),fecha_vencimiento:d().optional().refine(r=>!r||!isNaN(Date.parse(r)),"Fecha de vencimiento inválida"),sede_id:d({required_error:"Selecciona una sede"}),observaciones:d().optional()});function oe({setIsModalOpen:r}){const{sedes:h,fetchSedes:x}=W(),{selectHorario:m,selectedHorario:o,createHorario:j,updateHorario:f,deleteHorario:p}=re();v.useEffect(()=>{h.length===0&&x()},[]);const s=ee({resolver:X(ae),defaultValues:{concepto:"",valor_matricula:0,monto_total:0,observaciones:""}}),n=async a=>{if(o!=null&&o.id)try{await f(o.id,a),u.success("El horario fue actualizado correctamente."),m(null),r(!1)}catch(y){u.error("No se pudo actualizar el horario. Intenta de nuevo."),console.error("Error al actualizar",y)}else try{await j(a),u.success("El horario fue registrado correctamente."),m(null),r(!1)}catch(y){u.error("No se pudo registrar el horario. Intenta de nuevo."),console.error("Error al registrar",y)}};return e.jsx(Y,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(n),className:"space-y-4",children:[e.jsx(t,{control:s.control,name:"estudiante_id",render:({field:a})=>e.jsxs(i,{children:[e.jsx(c,{children:"Estudiante"}),e.jsx(l,{})]})}),e.jsx(t,{control:s.control,name:"concepto",render:({field:a})=>e.jsxs(i,{children:[e.jsx(c,{children:"Concepto"}),e.jsx(l,{})]})}),e.jsx(t,{control:s.control,name:"valor_matricula",render:({field:a})=>e.jsxs(i,{children:[e.jsx(c,{children:"Valor matrícula"}),e.jsx(l,{})]})}),e.jsx(t,{control:s.control,name:"monto_total",render:({field:a})=>e.jsxs(i,{children:[e.jsx(c,{children:"Monto total"}),e.jsx(l,{})]})}),e.jsx(t,{control:s.control,name:"fecha_emision",render:({field:a})=>e.jsxs(i,{children:[e.jsx(c,{children:"Fecha de emisión"}),e.jsx(l,{})]})}),e.jsx(t,{control:s.control,name:"fecha_vencimiento",render:({field:a})=>e.jsxs(i,{children:[e.jsx(c,{children:"Fecha de vencimiento"}),e.jsx(l,{})]})}),e.jsx(t,{control:s.control,name:"sede_id",render:({field:a})=>e.jsxs(i,{children:[e.jsx(c,{children:"Sede"}),e.jsx(l,{})]})}),e.jsx(t,{control:s.control,name:"observaciones",render:({field:a})=>e.jsxs(i,{children:[e.jsx(c,{children:"Observaciones"}),e.jsx(l,{})]})}),e.jsxs(T,{children:[e.jsx(E,{asChild:!0,children:e.jsx(g,{variant:"outline",children:"Cancelar"})}),e.jsx(g,{type:"submit",children:o?"Actualizar":"Agregar"}),e.jsxs(S,{children:[e.jsx(A,{asChild:!0,children:o&&e.jsx(g,{variant:"destructive",children:"Eliminar"})}),e.jsxs(K,{children:[e.jsxs(w,{children:[e.jsx(P,{children:"¿Estás seguro?"}),e.jsx(R,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(z,{children:[e.jsx(H,{children:"Cancelar"}),e.jsx(M,{onClick:async()=>{if(o!=null&&o.id)try{await p(o.id),u.success("La sede fue eliminada correctamente."),m(null),r(!1)}catch(a){u.error("No se pudo eliminar la sede. Intenta de nuevo."),console.error("Error al eliminar",a)}},children:"Confirmar"})]})]})]})]})]})})}function se({columns:r,data:h}){var s;const x=q({data:h,columns:r,getCoreRowModel:U(),manualPagination:!0}),[m,o]=v.useState(!1),{selectedPago:j,selectPago:f}=N(),p={setIsModalOpen:o};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Facturas"}),e.jsx(g,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{f(null),o(!0)},children:e.jsx(V,{})}),e.jsxs("div",{className:"rounded-md border",children:[m&&e.jsx(k,{open:m,onOpenChange:o,children:e.jsxs(I,{children:[e.jsxs(L,{children:[e.jsx(B,{children:j?"Editar Factura":"Agregar Factura"}),e.jsx(O,{children:j?"Modifica los datos de la factura y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar una nueva factura en el sistema."})]}),e.jsx(oe,{...p})]})}),e.jsxs($,{children:[e.jsx(G,{children:x.getHeaderGroups().map(n=>e.jsx(b,{children:n.headers.map(a=>e.jsx(J,{children:a.isPlaceholder?null:D(a.column.columnDef.header,a.getContext())},a.id))},n.id))}),e.jsx(Q,{className:"text-gray-600",children:(s=x.getRowModel().rows)!=null&&s.length?x.getRowModel().rows.map(n=>e.jsx(b,{onClick:()=>{f(n.original),o(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:n.getVisibleCells().map(a=>e.jsx(_,{className:"py-0.5",children:D(a.column.columnDef.cell,a.getContext())},a.id))},n.id)):e.jsx(b,{children:e.jsx(_,{colSpan:r.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const ne=[{accessorKey:"id",header:"#",cell:({row:r})=>r.index+1},{accessorKey:"estudiante_id",header:"Estudiante"},{accessorKey:"acudiente_id",header:"Acudiente"},{accessorKey:"tipo_documento",header:"Tipo documento"},{accessorKey:"numero_documento",header:"Documento"},{accessorKey:"email",header:"Correo electrónico"},{accessorKey:"direccion",header:"Dirección"},{accessorKey:"telefono",header:"Teléfono"},{accessorKey:"sede_id",header:"Sede"},{accessorKey:"fecha_emision",header:"Fecha de emisión"},{accessorKey:"fecha_vencimiento",header:"Fecha de vencimiento"},{accessorKey:"categoria",header:"Categoría"},{accessorKey:"concepto",header:"Concepto"},{accessorKey:"valor_matricula",header:"Valor matrícula"},{accessorKey:"monto_total",header:"Valor total"}];function he(){const{pagos:r,fetchPagos:h}=N();return v.useEffect(()=>{h()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(se,{data:r,columns:ne})})}export{he as default};
