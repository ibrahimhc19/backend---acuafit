import{i as _,r as F,j as e,B as b,t as m,h as P}from"./index-VBjVCV0-.js";import{d as I,e as k,u as z,D as K,a as O,b as B,c as G,m as J,T as U,f as X,g as C,h as q,i as T,j as Q,k as H,l as W}from"./dialog-vFENyMpH.js";import{i as Y,u as Z,A as ee,a as re,b as ae,c as se,d as oe,e as ie,f as ne,g as te,h as ce,P as le}from"./alert-dialog-3B2FFAB1.js";import{t as de,F as he,a as x,b as p,c as g,d as j,f,e as y,o as ue,s as S,g as M}from"./form-DfFrCefR.js";import{u as me}from"./index.esm-xF1FbULi.js";import{I as $}from"./createLucideIcon-B_u9e3Re.js";import{S as v,a as w,b as D,c as E,e as A}from"./select-7A1lJ8mn.js";import{t as L}from"./timeFormatter-DNfpeksr.js";import"./index-Cy8rr1hb.js";const xe=async()=>{var a,i,s,n;try{return(await _.get("client/horarios")).data.data}catch(r){const t=r,c=((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)??"Error inesperado",h=(n=(s=t.response)==null?void 0:s.data)==null?void 0:n.errors;throw{message:c,validationErrors:h}}},pe=async a=>{var i,s,n,r;try{return(await _.post("client/horario",a)).data}catch(t){const c=t,h=((s=(i=c.response)==null?void 0:i.data)==null?void 0:s.message)??"Error inesperado",l=(r=(n=c.response)==null?void 0:n.data)==null?void 0:r.errors;throw{message:h,validationErrors:l}}},ge=async(a,i)=>{var s,n,r,t;try{return(await _.patch(`client/horario/${a}`,i)).data}catch(c){const h=c,l=((n=(s=h.response)==null?void 0:s.data)==null?void 0:n.message)??"Error inesperado",u=(t=(r=h.response)==null?void 0:r.data)==null?void 0:t.errors;throw{message:l,validationErrors:u}}},je=async a=>{var i,s,n,r;try{return(await _.delete(`client/horario/${a}`)).data}catch(t){const c=t,h=((s=(i=c.response)==null?void 0:i.data)==null?void 0:s.message)??"Error inesperado",l=(r=(n=c.response)==null?void 0:n.data)==null?void 0:r.errors;throw{message:h,validationErrors:l}}},N=Y((a,i)=>({horarios:[],selectedHorario:null,loading:!1,error:null,fetchHorarios:async()=>{a({loading:!0,error:null});try{const s=await xe();a({horarios:s})}catch(s){a({error:s.message||"Error al cargar horarios"})}finally{a({loading:!1})}},createHorario:async s=>{await pe(s),await i().fetchHorarios()},updateHorario:async(s,n)=>{await ge(s,n),await i().fetchHorarios()},deleteHorario:async s=>{await je(s),await i().fetchHorarios()},selectHorario:s=>{a({selectedHorario:s})}})),R=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"],V=["Adultos","Hidroaeróbicos","Apnea","Niños","Niños 2-4 años","Niños 5-10 años","Bebés 10-23 meses"],fe=ue({tipo_grupo:M(V),dia_semana:M(R),hora_inicio:S().min(1,{message:"La hora de inicio es obligatoria"}),hora_fin:S().min(1,{message:"La hora de fin es obligatoria"}),sede_id:S().min(1,{message:"La dirección de la horario es obligatoria"})}).refine(a=>{const[i,s]=a.hora_inicio.split(":").map(Number),[n,r]=a.hora_fin.split(":").map(Number),t=i*60+s;return n*60+r>t},{message:"La hora de fin debe ser posterior a la hora de inicio",path:["hora_fin"]});function ye({setIsModalOpen:a}){const{sedes:i,fetchSedes:s}=Z(),{selectHorario:n,selectedHorario:r,createHorario:t,updateHorario:c,deleteHorario:h}=N();F.useEffect(()=>{i.length===0&&s()},[]);const l=me({resolver:de(fe),defaultValues:{tipo_grupo:`${(r==null?void 0:r.tipo_grupo)??""}`,dia_semana:`${(r==null?void 0:r.dia_semana)??""}`,hora_inicio:`${(r==null?void 0:r.hora_inicio)??"07:00:00"}`,hora_fin:`${(r==null?void 0:r.hora_fin)??"08:00:00"}`,sede_id:`${(r==null?void 0:r.sede_id)??""}`}}),u=async o=>{if(r!=null&&r.id)try{await c(r.id,o),m.success("La horario fue actualizada correctamente."),n(null),a(!1)}catch(d){m.error("No se pudo actualizar la horario. Intenta de nuevo."),console.error("Error al actualizar",d)}else try{await t(o),m.success("La horario fue registrada correctamente."),n(null),a(!1)}catch(d){m.error("No se pudo registrar la horario. Intenta de nuevo."),console.error("Error al registrar",d)}};return console.log(r),e.jsx(he,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(u),className:"space-y-8",children:[e.jsx(x,{control:l.control,name:"tipo_grupo",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Grupo"}),e.jsxs(v,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(w,{children:e.jsx(D,{placeholder:"Tipos de grupo"})})}),e.jsx(E,{children:V.map(d=>e.jsx(A,{value:d,children:d}))})]}),e.jsx(f,{children:"Puedes seleccionar el tipo de grupo."}),e.jsx(y,{})]})}),e.jsx(x,{control:l.control,name:"dia_semana",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Día"}),e.jsxs(v,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(w,{children:e.jsx(D,{placeholder:"Opciones de días"})})}),e.jsx(E,{children:R.map(d=>e.jsx(A,{value:d,children:d}))})]}),e.jsx(f,{children:"Puedes seleccionar el día."}),e.jsx(y,{})]})}),e.jsx(x,{control:l.control,name:"sede_id",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Sede"}),e.jsxs(v,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(w,{children:e.jsx(D,{placeholder:"Opciones de sedes"})})}),e.jsx(E,{children:i.map(d=>e.jsx(A,{value:d.id.toString(),children:d.nombre},d.id))})]}),e.jsx(f,{children:"Puedes seleccionar la sede."}),e.jsx(y,{})]})}),e.jsx(x,{control:l.control,name:"hora_inicio",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Hora de inicio"}),e.jsx(j,{children:e.jsx($,{...o,type:"time",id:"time-picker",step:"1"})}),e.jsx(f,{children:"Selecciona la hora de inicio."}),e.jsx(y,{})]})}),e.jsx(x,{control:l.control,name:"hora_fin",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Hora de fin"}),e.jsx(j,{children:e.jsx($,{...o,type:"time",id:"time-picker",step:"1"})}),e.jsx(f,{children:"Selecciona la hora de inicio."}),e.jsx(y,{})]})}),e.jsxs(I,{children:[e.jsx(k,{asChild:!0,children:e.jsx(b,{variant:"outline",children:"Cancelar"})}),e.jsx(b,{type:"submit",children:r?"Actualizar":"Agregar"}),e.jsxs(ee,{children:[e.jsx(re,{asChild:!0,children:r&&e.jsx(b,{variant:"destructive",children:"Eliminar"})}),e.jsxs(ae,{children:[e.jsxs(se,{children:[e.jsx(oe,{children:"¿Estás seguro?"}),e.jsx(ie,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(ne,{children:[e.jsx(te,{children:"Cancelar"}),e.jsx(ce,{onClick:async()=>{if(r!=null&&r.id)try{await h(r.id),m.success("La sede fue eliminada correctamente."),n(null),a(!1)}catch(o){m.error("No se pudo eliminar la sede. Intenta de nuevo."),console.error("Error al eliminar",o)}},children:"Confirmar"})]})]})]})]})]})})}function be({columns:a,data:i}){var l;const s=z({data:i,columns:a,getCoreRowModel:W(),manualPagination:!0}),[n,r]=F.useState(!1),{selectedHorario:t,selectHorario:c}=N(),h={setIsModalOpen:r};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Horarios"}),e.jsx(b,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{c(null),r(!0)},children:e.jsx(le,{})}),e.jsxs("div",{className:"rounded-md border",children:[n&&e.jsx(K,{open:n,onOpenChange:r,children:e.jsxs(O,{children:[e.jsxs(B,{children:[e.jsx(G,{children:t?"Editar Horario":"Agregar Horario"}),e.jsx(J,{children:t?"Modifica los datos del horario y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo horario en el sistema."})]}),e.jsx(ye,{...h})]})}),e.jsxs(U,{children:[e.jsx(X,{children:s.getHeaderGroups().map(u=>e.jsx(C,{children:u.headers.map(o=>e.jsx(q,{children:o.isPlaceholder?null:T(o.column.columnDef.header,o.getContext())},o.id))},u.id))}),e.jsx(Q,{className:"text-gray-600",children:(l=s.getRowModel().rows)!=null&&l.length?s.getRowModel().rows.map(u=>e.jsx(C,{onClick:()=>{c(u.original),r(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:u.getVisibleCells().map(o=>e.jsx(H,{className:"py-0.5",children:T(o.column.columnDef.cell,o.getContext())},o.id))},u.id)):e.jsx(C,{children:e.jsx(H,{colSpan:a.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const _e=[{accessorKey:"id",header:"#",cell:({row:a})=>a.index+1},{accessorKey:"tipo_grupo",header:"Grupo",accessorFn:a=>`${a.tipo_grupo}`},{accessorKey:"sede.nombre",header:"Sede"},{accessorKey:"dia_semana",header:"Día"},{accessorKey:"hora_inicio",header:"Hora de inicio",accessorFn:a=>`${L(a.hora_inicio)}`},{accessorKey:"hora_fin",header:"Hora de fin",accessorFn:a=>`${L(a.hora_fin)}`}];P.defaults.withCredentials=!0;P.defaults.withXSRFToken=!0;function Te(){const{horarios:a,fetchHorarios:i}=N();return F.useEffect(()=>{i()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(be,{data:a,columns:_e})})}export{Te as default};
