import{r as y,j as e,T as I,D as M,B as C,t as m,k as P}from"./index-B6Pfli54.js";import{d as L,e as B,u as G,P as O,D as U,a as X,b as q,c as J,m as Q,T as W,f as Y,g as D,h as Z,i as V,j as ee,k,l as ae}from"./dialog-Bvdgjq44.js";import{u as w}from"./useHorariosStore-49jmiLXZ.js";import{u as re,t as se,F as ie,a as g,b as p,c as f,d as b,e as _,o as oe,s as v,f as z}from"./form-CDN1QS-x.js";import{u as ne}from"./index.esm-DgpJp5yw.js";import{I as $}from"./input-CvjoZMAX.js";import{S as T,a as A,b as F,d as E,g as N}from"./select-BOpiJw6T.js";import{A as le,a as te,b as ce,c as de,d as he,e as ue,f as me,g as xe,h as je}from"./alert-dialog-CduGDlTD.js";import{t as H}from"./timeFormatter-DNfpeksr.js";import"./react-C20NM8gs.js";import"./index-BbGv7Wcj.js";const ge=oe({tipo_grupo:z(I),dia_semana:z(M),hora_inicio:v().min(1,{message:"La hora de inicio es obligatoria"}),hora_fin:v().min(1,{message:"La hora de fin es obligatoria"}),sede_id:v().min(1,{message:"La dirección de la horario es obligatoria"})}).refine(r=>{const[l,c]=r.hora_inicio.split(":").map(Number),[t,a]=r.hora_fin.split(":").map(Number),h=l*60+c;return t*60+a>h},{message:"La hora de fin debe ser posterior a la hora de inicio",path:["hora_fin"]});function pe({setIsModalOpen:r}){const{sedes:l,fetchSedes:c}=re(),{selectHorario:t,selectedHorario:a,createHorario:h,updateHorario:x,deleteHorario:S}=w(),[u,n]=y.useState(!1),[i,R]=y.useState(!1);y.useEffect(()=>{l.length===0&&c()},[]);const d=ne({resolver:se(ge),defaultValues:{tipo_grupo:`${(a==null?void 0:a.tipo_grupo)??""}`,dia_semana:`${(a==null?void 0:a.dia_semana)??""}`,hora_inicio:`${(a==null?void 0:a.hora_inicio)??"07:00:00"}`,hora_fin:`${(a==null?void 0:a.hora_fin)??"08:00:00"}`,sede_id:`${(a==null?void 0:a.sede_id)??""}`}}),K=async s=>{if(n(!0),a!=null&&a.id)try{await x(a.id,s),m.success("El horario fue actualizado correctamente."),t(null),r(!1)}catch(o){m.error("No se pudo actualizar el horario. Intenta de nuevo."),console.error("Error al actualizar",o)}finally{n(!1),r(!1)}else try{await h(s),m.success("El horario fue registrado correctamente."),t(null),r(!1)}catch(o){m.error("No se pudo registrar el horario. Intenta de nuevo."),console.error("Error al registrar",o)}finally{n(!1),r(!1)}};return e.jsx(ie,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(K),className:"space-y-4",children:[e.jsx(g,{control:d.control,name:"tipo_grupo",render:({field:s})=>e.jsxs(p,{children:[e.jsx(f,{children:"Grupo"}),e.jsxs(T,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(b,{children:e.jsx(A,{children:e.jsx(F,{placeholder:"Tipos de grupo"})})}),e.jsx(E,{children:I.map((o,j)=>e.jsx(N,{value:o,children:o},j))})]}),e.jsx(_,{})]})}),e.jsx(g,{control:d.control,name:"dia_semana",render:({field:s})=>e.jsxs(p,{children:[e.jsx(f,{children:"Día"}),e.jsxs(T,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(b,{children:e.jsx(A,{children:e.jsx(F,{placeholder:"Opciones de días"})})}),e.jsx(E,{children:M.map((o,j)=>e.jsx(N,{value:o,children:o},j))})]}),e.jsx(_,{})]})}),e.jsx(g,{control:d.control,name:"sede_id",render:({field:s})=>e.jsxs(p,{children:[e.jsx(f,{children:"Sede"}),e.jsxs(T,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(b,{children:e.jsx(A,{children:e.jsx(F,{placeholder:"Opciones de sedes"})})}),e.jsx(E,{children:l.map((o,j)=>e.jsx(N,{value:o.id.toString(),children:o.nombre},j))})]}),e.jsx(_,{})]})}),e.jsx(g,{control:d.control,name:"hora_inicio",render:({field:s})=>e.jsxs(p,{children:[e.jsx(f,{children:"Hora de inicio"}),e.jsx(b,{children:e.jsx($,{...s,type:"time",id:"time-picker",step:"1"})}),e.jsx(_,{})]})}),e.jsx(g,{control:d.control,name:"hora_fin",render:({field:s})=>e.jsxs(p,{children:[e.jsx(f,{children:"Hora de fin"}),e.jsx(b,{children:e.jsx($,{...s,type:"time",id:"time-picker",step:"1"})}),e.jsx(_,{})]})}),e.jsxs(L,{children:[e.jsx(B,{asChild:!0,children:e.jsx(C,{variant:"outline",children:"Cancelar"})}),e.jsx(C,{type:"submit",disabled:u,children:u?"Actualizando":a?"Actualizar":"Agregar"}),e.jsxs(le,{children:[e.jsx(te,{asChild:!0,children:a&&e.jsx(C,{variant:"destructive",disabled:i?!0:!a,children:i?"Eliminando":"Eliminar"})}),e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(he,{children:"¿Estás seguro?"}),e.jsx(ue,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(me,{children:[e.jsx(xe,{children:"Cancelar"}),e.jsx(je,{disabled:u,onClick:async()=>{if(a!=null&&a.id){R(!0);try{await S(a.id),m.success("El horario fue eliminado correctamente."),t(null),r(!1)}catch(s){m.error("No se pudo eliminar el horario. Intenta de nuevo."),console.error("Error al eliminar",s)}finally{R(!1),r(!1)}}},children:i?"Eliminando":"Confirmar"})]})]})]})]})]})})}function fe({columns:r,data:l}){var u;const c=G({data:l,columns:r,getCoreRowModel:ae(),manualPagination:!0}),[t,a]=y.useState(!1),{selectedHorario:h,selectHorario:x}=w(),S={setIsModalOpen:a};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Horarios"}),e.jsx(C,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{x(null),a(!0)},children:e.jsx(O,{})}),e.jsxs("div",{className:"rounded-md border",children:[t&&e.jsx(U,{open:t,onOpenChange:a,children:e.jsxs(X,{children:[e.jsxs(q,{children:[e.jsx(J,{children:h?"Editar Horario":"Agregar Horario"}),e.jsx(Q,{children:h?"Modifica los datos del horario y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo horario en el sistema."})]}),e.jsx(pe,{...S})]})}),e.jsxs(W,{children:[e.jsx(Y,{children:c.getHeaderGroups().map(n=>e.jsx(D,{children:n.headers.map(i=>e.jsx(Z,{children:i.isPlaceholder?null:V(i.column.columnDef.header,i.getContext())},i.id))},n.id))}),e.jsx(ee,{className:"text-gray-600",children:(u=c.getRowModel().rows)!=null&&u.length?c.getRowModel().rows.map(n=>e.jsx(D,{onClick:()=>{x(n.original),a(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:n.getVisibleCells().map(i=>e.jsx(k,{className:"py-0.5",children:V(i.column.columnDef.cell,i.getContext())},i.id))},n.id)):e.jsx(D,{children:e.jsx(k,{colSpan:r.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const be=[{accessorKey:"id",header:"#",cell:({row:r})=>r.index+1},{accessorKey:"tipo_grupo",header:"Grupo",accessorFn:r=>`${r.tipo_grupo}`},{accessorKey:"sede.nombre",header:"Sede"},{accessorKey:"dia_semana",header:"Día"},{accessorKey:"hora_inicio",header:"Hora de inicio",accessorFn:r=>`${H(r.hora_inicio)}`},{accessorKey:"hora_fin",header:"Hora de fin",accessorFn:r=>`${H(r.hora_fin)}`}];P.defaults.withCredentials=!0;P.defaults.withXSRFToken=!0;function we(){const{horarios:r,fetchHorarios:l}=w();return y.useEffect(()=>{l()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(fe,{data:r,columns:be})})}export{we as default};
