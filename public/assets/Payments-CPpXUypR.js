import{b,r as S,j as e,B as y,t as u,d as M}from"./index-2LiSZXBZ.js";import{d as $,e as I,u as k,D as z,a as K,b as O,c as B,m as G,T as U,f as X,g as _,h as q,i as T,j as J,k as A,l as Q}from"./dialog-DMjTJuR_.js";import{c as W,P as Y}from"./react-CfnTfrbB.js";import{t as Z,F as H,a as g,b as p,c as x,d as j,e as f,o as ee,s as C,f as N}from"./form-CyqIswPS.js";import{u as ae}from"./index.esm-16thhunR.js";import{I as F}from"./createLucideIcon-ChwpPmIM.js";import{S as w,a as v,b as E,c as D,T as R,e as P,D as L}from"./constants-BYJ4P_pl.js";import{u as re}from"./useHorariosStore-B2NyIm-T.js";import{u as se,A as oe,a as ne,b as te,c as ie,d as le,e as ce,f as de,g as he,h as me}from"./alert-dialog-B-GYgm1E.js";import"./Combination-KtqryYF5.js";const ue=async()=>{var s,n,r,t;try{return(await b.get("client/pagos")).data.data}catch(a){const i=a,l=((n=(s=i.response)==null?void 0:s.data)==null?void 0:n.message)??"Error inesperado",h=(t=(r=i.response)==null?void 0:r.data)==null?void 0:t.errors;throw{message:l,validationErrors:h}}},ge=async s=>{var n,r,t,a;try{return(await b.post("client/pago",s)).data}catch(i){const l=i,h=((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.message)??"Error inesperado",c=(a=(t=l.response)==null?void 0:t.data)==null?void 0:a.errors;throw{message:h,validationErrors:c}}},pe=async(s,n)=>{var r,t,a,i;try{return(await b.patch(`client/pago/${s}`,n)).data}catch(l){const h=l,c=((t=(r=h.response)==null?void 0:r.data)==null?void 0:t.message)??"Error inesperado",m=(i=(a=h.response)==null?void 0:a.data)==null?void 0:i.errors;throw{message:c,validationErrors:m}}},xe=async s=>{var n,r,t,a;try{return(await b.delete(`client/pago/${s}`)).data}catch(i){const l=i,h=((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.message)??"Error inesperado",c=(a=(t=l.response)==null?void 0:t.data)==null?void 0:a.errors;throw{message:h,validationErrors:c}}},V=W((s,n)=>({pagos:[],selectedPago:null,loading:!1,error:null,fetchPagos:async()=>{s({loading:!0,error:null});try{const r=await ue();s({pagos:r})}catch(r){s({error:r.message||"Error al cargar pagos"})}finally{s({loading:!1})}},createPago:async r=>{await ge(r),await n().fetchPagos()},updatePago:async(r,t)=>{await pe(r,t),await n().fetchPagos()},deletePago:async r=>{await xe(r),await n().fetchPagos()},selectPago:r=>{s({selectedPago:r})}})),je=ee({tipo_grupo:N(R),dia_semana:N(L),hora_inicio:C().min(1,{message:"La hora de inicio es obligatoria"}),hora_fin:C().min(1,{message:"La hora de fin es obligatoria"}),sede_id:C().min(1,{message:"La dirección de la horario es obligatoria"})}).refine(s=>{const[n,r]=s.hora_inicio.split(":").map(Number),[t,a]=s.hora_fin.split(":").map(Number),i=n*60+r;return t*60+a>i},{message:"La hora de fin debe ser posterior a la hora de inicio",path:["hora_fin"]});function fe({setIsModalOpen:s}){const{sedes:n,fetchSedes:r}=se(),{selectHorario:t,selectedHorario:a,createHorario:i,updateHorario:l,deleteHorario:h}=re();S.useEffect(()=>{n.length===0&&r()},[]);const c=ae({resolver:Z(je),defaultValues:{tipo_grupo:`${(a==null?void 0:a.tipo_grupo)??""}`,dia_semana:`${(a==null?void 0:a.dia_semana)??""}`,hora_inicio:`${(a==null?void 0:a.hora_inicio)??"07:00:00"}`,hora_fin:`${(a==null?void 0:a.hora_fin)??"08:00:00"}`,sede_id:`${(a==null?void 0:a.sede_id)??""}`}}),m=async o=>{if(a!=null&&a.id)try{await l(a.id,o),u.success("La horario fue actualizada correctamente."),t(null),s(!1)}catch(d){u.error("No se pudo actualizar la horario. Intenta de nuevo."),console.error("Error al actualizar",d)}else try{await i(o),u.success("La horario fue registrada correctamente."),t(null),s(!1)}catch(d){u.error("No se pudo registrar la horario. Intenta de nuevo."),console.error("Error al registrar",d)}};return e.jsx(H,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(m),className:"space-y-4",children:[e.jsx(g,{control:c.control,name:"tipo_grupo",render:({field:o})=>e.jsxs(p,{children:[e.jsx(x,{children:"Grupo"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(v,{children:e.jsx(E,{placeholder:"Tipos de grupo"})})}),e.jsx(D,{children:R.map(d=>e.jsx(P,{value:d,children:d}))})]}),e.jsx(f,{})]})}),e.jsx(g,{control:c.control,name:"dia_semana",render:({field:o})=>e.jsxs(p,{children:[e.jsx(x,{children:"Día"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(v,{children:e.jsx(E,{placeholder:"Opciones de días"})})}),e.jsx(D,{children:L.map(d=>e.jsx(P,{value:d,children:d}))})]}),e.jsx(f,{})]})}),e.jsx(g,{control:c.control,name:"sede_id",render:({field:o})=>e.jsxs(p,{children:[e.jsx(x,{children:"Sede"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(v,{children:e.jsx(E,{placeholder:"Opciones de sedes"})})}),e.jsx(D,{children:n.map(d=>e.jsx(P,{value:d.id.toString(),children:d.nombre},d.id))})]}),e.jsx(f,{})]})}),e.jsx(g,{control:c.control,name:"hora_inicio",render:({field:o})=>e.jsxs(p,{children:[e.jsx(x,{children:"Hora de inicio"}),e.jsx(j,{children:e.jsx(F,{...o,type:"time",id:"time-picker",step:"1"})}),e.jsx(f,{})]})}),e.jsx(g,{control:c.control,name:"hora_fin",render:({field:o})=>e.jsxs(p,{children:[e.jsx(x,{children:"Hora de fin"}),e.jsx(j,{children:e.jsx(F,{...o,type:"time",id:"time-picker",step:"1"})}),e.jsx(f,{})]})}),e.jsxs($,{children:[e.jsx(I,{asChild:!0,children:e.jsx(y,{variant:"outline",children:"Cancelar"})}),e.jsx(y,{type:"submit",children:a?"Actualizar":"Agregar"}),e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:a&&e.jsx(y,{variant:"destructive",children:"Eliminar"})}),e.jsxs(te,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:"¿Estás seguro?"}),e.jsx(ce,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(de,{children:[e.jsx(he,{children:"Cancelar"}),e.jsx(me,{onClick:async()=>{if(a!=null&&a.id)try{await h(a.id),u.success("La sede fue eliminada correctamente."),t(null),s(!1)}catch(o){u.error("No se pudo eliminar la sede. Intenta de nuevo."),console.error("Error al eliminar",o)}},children:"Confirmar"})]})]})]})]})]})})}function ye({columns:s,data:n}){var c;const r=k({data:n,columns:s,getCoreRowModel:Q(),manualPagination:!0}),[t,a]=S.useState(!1),{selectedPago:i,selectPago:l}=V(),h={setIsModalOpen:a};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Pagos"}),e.jsx(y,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{l(null),a(!0)},children:e.jsx(Y,{})}),e.jsxs("div",{className:"rounded-md border",children:[t&&e.jsx(z,{open:t,onOpenChange:a,children:e.jsxs(K,{children:[e.jsxs(O,{children:[e.jsx(B,{children:i?"Editar Pago":"Agregar Pago"}),e.jsx(G,{children:i?"Modifica los datos del pago y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo pago en el sistema."})]}),e.jsx(fe,{...h})]})}),e.jsxs(U,{children:[e.jsx(X,{children:r.getHeaderGroups().map(m=>e.jsx(_,{children:m.headers.map(o=>e.jsx(q,{children:o.isPlaceholder?null:T(o.column.columnDef.header,o.getContext())},o.id))},m.id))}),e.jsx(J,{className:"text-gray-600",children:(c=r.getRowModel().rows)!=null&&c.length?r.getRowModel().rows.map(m=>e.jsx(_,{onClick:()=>{l(m.original),a(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:m.getVisibleCells().map(o=>e.jsx(A,{className:"py-0.5",children:T(o.column.columnDef.cell,o.getContext())},o.id))},m.id)):e.jsx(_,{children:e.jsx(A,{colSpan:s.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const be=[{accessorKey:"id",header:"#",cell:({row:s})=>s.index+1},{accessorKey:"monto",header:"Monto"},{accessorKey:"fecha_pago",header:"Fecha"},{accessorKey:"metodo_pago",header:"Metodo de pago"},{accessorKey:"numero_referencia_pago",header:"Número de referencia"},{accessorKey:"soporte_pago",header:"Soporte de pago"},{accessorKey:"estudiante",header:"Estudiante"}];M.defaults.withCredentials=!0;M.defaults.withXSRFToken=!0;function Ne(){const{pagos:s,fetchPagos:n}=V();return S.useEffect(()=>{n()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(ye,{data:s,columns:be})})}export{Ne as default};
