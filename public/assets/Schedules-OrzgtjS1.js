import{r as A,j as e,B as f,t as h,d as L}from"./index-2LiSZXBZ.js";import{d as $,e as k,u as z,D as H,a as P,b as K,c as O,m as B,T as G,f as U,g as _,h as X,i as N,j as q,k as w,l as J}from"./dialog-DMjTJuR_.js";import{u as F}from"./useHorariosStore-B2NyIm-T.js";import{t as Q,F as W,a as u,b as x,c as j,d as p,e as g,o as Y,s as C,f as E}from"./form-CyqIswPS.js";import{u as Z}from"./index.esm-16thhunR.js";import{I as M}from"./createLucideIcon-ChwpPmIM.js";import{S as y,a as D,b as S,c as v,T as V,e as T,D as I}from"./constants-BYJ4P_pl.js";import{u as ee,A as re,a as ae,b as se,c as oe,d as ie,e as ne,f as le,g as te,h as ce}from"./alert-dialog-B-GYgm1E.js";import{P as de}from"./react-CfnTfrbB.js";import{t as R}from"./timeFormatter-DNfpeksr.js";import"./Combination-KtqryYF5.js";const he=Y({tipo_grupo:E(V),dia_semana:E(I),hora_inicio:C().min(1,{message:"La hora de inicio es obligatoria"}),hora_fin:C().min(1,{message:"La hora de fin es obligatoria"}),sede_id:C().min(1,{message:"La dirección de la horario es obligatoria"})}).refine(s=>{const[n,c]=s.hora_inicio.split(":").map(Number),[l,r]=s.hora_fin.split(":").map(Number),d=n*60+c;return l*60+r>d},{message:"La hora de fin debe ser posterior a la hora de inicio",path:["hora_fin"]});function me({setIsModalOpen:s}){const{sedes:n,fetchSedes:c}=ee(),{selectHorario:l,selectedHorario:r,createHorario:d,updateHorario:m,deleteHorario:b}=F();A.useEffect(()=>{n.length===0&&c()},[]);const i=Z({resolver:Q(he),defaultValues:{tipo_grupo:`${(r==null?void 0:r.tipo_grupo)??""}`,dia_semana:`${(r==null?void 0:r.dia_semana)??""}`,hora_inicio:`${(r==null?void 0:r.hora_inicio)??"07:00:00"}`,hora_fin:`${(r==null?void 0:r.hora_fin)??"08:00:00"}`,sede_id:`${(r==null?void 0:r.sede_id)??""}`}}),t=async a=>{if(r!=null&&r.id)try{await m(r.id,a),h.success("La horario fue actualizada correctamente."),l(null),s(!1)}catch(o){h.error("No se pudo actualizar la horario. Intenta de nuevo."),console.error("Error al actualizar",o)}else try{await d(a),h.success("La horario fue registrada correctamente."),l(null),s(!1)}catch(o){h.error("No se pudo registrar la horario. Intenta de nuevo."),console.error("Error al registrar",o)}};return e.jsx(W,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(t),className:"space-y-4",children:[e.jsx(u,{control:i.control,name:"tipo_grupo",render:({field:a})=>e.jsxs(x,{children:[e.jsx(j,{children:"Grupo"}),e.jsxs(y,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(p,{children:e.jsx(D,{children:e.jsx(S,{placeholder:"Tipos de grupo"})})}),e.jsx(v,{children:V.map(o=>e.jsx(T,{value:o,children:o}))})]}),e.jsx(g,{})]})}),e.jsx(u,{control:i.control,name:"dia_semana",render:({field:a})=>e.jsxs(x,{children:[e.jsx(j,{children:"Día"}),e.jsxs(y,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(p,{children:e.jsx(D,{children:e.jsx(S,{placeholder:"Opciones de días"})})}),e.jsx(v,{children:I.map(o=>e.jsx(T,{value:o,children:o}))})]}),e.jsx(g,{})]})}),e.jsx(u,{control:i.control,name:"sede_id",render:({field:a})=>e.jsxs(x,{children:[e.jsx(j,{children:"Sede"}),e.jsxs(y,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(p,{children:e.jsx(D,{children:e.jsx(S,{placeholder:"Opciones de sedes"})})}),e.jsx(v,{children:n.map(o=>e.jsx(T,{value:o.id.toString(),children:o.nombre},o.id))})]}),e.jsx(g,{})]})}),e.jsx(u,{control:i.control,name:"hora_inicio",render:({field:a})=>e.jsxs(x,{children:[e.jsx(j,{children:"Hora de inicio"}),e.jsx(p,{children:e.jsx(M,{...a,type:"time",id:"time-picker",step:"1"})}),e.jsx(g,{})]})}),e.jsx(u,{control:i.control,name:"hora_fin",render:({field:a})=>e.jsxs(x,{children:[e.jsx(j,{children:"Hora de fin"}),e.jsx(p,{children:e.jsx(M,{...a,type:"time",id:"time-picker",step:"1"})}),e.jsx(g,{})]})}),e.jsxs($,{children:[e.jsx(k,{asChild:!0,children:e.jsx(f,{variant:"outline",children:"Cancelar"})}),e.jsx(f,{type:"submit",children:r?"Actualizar":"Agregar"}),e.jsxs(re,{children:[e.jsx(ae,{asChild:!0,children:r&&e.jsx(f,{variant:"destructive",children:"Eliminar"})}),e.jsxs(se,{children:[e.jsxs(oe,{children:[e.jsx(ie,{children:"¿Estás seguro?"}),e.jsx(ne,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(le,{children:[e.jsx(te,{children:"Cancelar"}),e.jsx(ce,{onClick:async()=>{if(r!=null&&r.id)try{await b(r.id),h.success("La sede fue eliminada correctamente."),l(null),s(!1)}catch(a){h.error("No se pudo eliminar la sede. Intenta de nuevo."),console.error("Error al eliminar",a)}},children:"Confirmar"})]})]})]})]})]})})}function ue({columns:s,data:n}){var i;const c=z({data:n,columns:s,getCoreRowModel:J(),manualPagination:!0}),[l,r]=A.useState(!1),{selectedHorario:d,selectHorario:m}=F(),b={setIsModalOpen:r};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Horarios"}),e.jsx(f,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{m(null),r(!0)},children:e.jsx(de,{})}),e.jsxs("div",{className:"rounded-md border",children:[l&&e.jsx(H,{open:l,onOpenChange:r,children:e.jsxs(P,{children:[e.jsxs(K,{children:[e.jsx(O,{children:d?"Editar Horario":"Agregar Horario"}),e.jsx(B,{children:d?"Modifica los datos del horario y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo horario en el sistema."})]}),e.jsx(me,{...b})]})}),e.jsxs(G,{children:[e.jsx(U,{children:c.getHeaderGroups().map(t=>e.jsx(_,{children:t.headers.map(a=>e.jsx(X,{children:a.isPlaceholder?null:N(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx(q,{className:"text-gray-600",children:(i=c.getRowModel().rows)!=null&&i.length?c.getRowModel().rows.map(t=>e.jsx(_,{onClick:()=>{m(t.original),r(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:t.getVisibleCells().map(a=>e.jsx(w,{className:"py-0.5",children:N(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(_,{children:e.jsx(w,{colSpan:s.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const xe=[{accessorKey:"id",header:"#",cell:({row:s})=>s.index+1},{accessorKey:"tipo_grupo",header:"Grupo",accessorFn:s=>`${s.tipo_grupo}`},{accessorKey:"sede.nombre",header:"Sede"},{accessorKey:"dia_semana",header:"Día"},{accessorKey:"hora_inicio",header:"Hora de inicio",accessorFn:s=>`${R(s.hora_inicio)}`},{accessorKey:"hora_fin",header:"Hora de fin",accessorFn:s=>`${R(s.hora_fin)}`}];L.defaults.withCredentials=!0;L.defaults.withXSRFToken=!0;function Te(){const{horarios:s,fetchHorarios:n}=F();return A.useEffect(()=>{n()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(ue,{data:s,columns:xe})})}export{Te as default};
