import{r as v,j as e,B as j,t,k as _}from"./index-DQzoP3-T.js";import{d as N,e as T,A as S,f as A,g as E,h as P,i as w,j as M,k as R,l as K,m as z,u as H,P as k,D as q,a as L,b as B,c as I,v as O,T as V,n as X,o as y,p as $,q as D,r as G,s as C,t as J}from"./alert-dialog-Cs1cvAZt.js";import{u as F}from"./usePagosStore-1klliRjq.js";import{u as Q,t as U,F as W,a as m,b as u,c as h,e as g,o as Y,s as l,g as Z,n as ee}from"./form-D--MMcln.js";import{u as ae}from"./index.esm-BXgtbUd1.js";import{u as re}from"./useHorariosStore-B2T97uUU.js";import"./react-CnBH8Oww.js";const oe=Y({factura_id:l({required_error:"Factura no válida"}),fecha_pago:l({required_error:"La fecha de pago es obligatoria"}).refine(r=>!isNaN(Date.parse(r)),"Fecha inválida"),monto_abono:Z([l().regex(/^\d+(\.\d{1,2})?$/,"Debe ser un número válido"),ee()]).transform(r=>Number(r)).refine(r=>r>0,"El monto debe ser mayor que cero"),medio_pago:l({required_error:"Selecciona un medio de pago"}).min(1,"Selecciona un medio de pago"),comprobante:l().optional(),observaciones:l().optional()});function se({setIsModalOpen:r}){const{sedes:c,fetchSedes:d}=Q(),{selectHorario:i,selectedHorario:o,createHorario:x,updateHorario:p,deleteHorario:f}=re();v.useEffect(()=>{c.length===0&&d()},[]);const s=ae({resolver:U(oe),defaultValues:{fecha_pago:"",medio_pago:"",monto_abono:0,comprobante:"",observaciones:""}}),n=async a=>{if(o!=null&&o.id)try{await p(o.id,a),t.success("El horario fue actualizado correctamente."),i(null),r(!1)}catch(b){t.error("No se pudo actualizar el horario. Intenta de nuevo."),console.error("Error al actualizar",b)}else try{await x(a),t.success("El horario fue registrado correctamente."),i(null),r(!1)}catch(b){t.error("No se pudo registrar el horario. Intenta de nuevo."),console.error("Error al registrar",b)}};return e.jsx(W,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(n),className:"space-y-4",children:[e.jsx(m,{control:s.control,name:"fecha_pago",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Fecha de pago"}),e.jsx(g,{})]})}),e.jsx(m,{control:s.control,name:"monto_abono",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Monto abonado"}),e.jsx(g,{})]})}),e.jsx(m,{control:s.control,name:"medio_pago",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Medio de pago"}),e.jsx(g,{})]})}),e.jsx(m,{control:s.control,name:"comprobante",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Comprobante o referencia"}),e.jsx(g,{})]})}),e.jsx(m,{control:s.control,name:"observaciones",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Observaciones"}),e.jsx(g,{})]})}),e.jsxs(N,{children:[e.jsx(T,{asChild:!0,children:e.jsx(j,{variant:"outline",children:"Cancelar"})}),e.jsx(j,{type:"submit",children:o?"Actualizar":"Agregar"}),e.jsxs(S,{children:[e.jsx(A,{asChild:!0,children:o&&e.jsx(j,{variant:"destructive",children:"Eliminar"})}),e.jsxs(E,{children:[e.jsxs(P,{children:[e.jsx(w,{children:"¿Estás seguro?"}),e.jsx(M,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(R,{children:[e.jsx(K,{children:"Cancelar"}),e.jsx(z,{onClick:async()=>{if(o!=null&&o.id)try{await f(o.id),t.success("La sede fue eliminada correctamente."),i(null),r(!1)}catch(a){t.error("No se pudo eliminar la sede. Intenta de nuevo."),console.error("Error al eliminar",a)}},children:"Confirmar"})]})]})]})]})]})})}function ne({columns:r,data:c}){var s;const d=H({data:c,columns:r,getCoreRowModel:J(),manualPagination:!0}),[i,o]=v.useState(!1),{selectedPago:x,selectPago:p}=F(),f={setIsModalOpen:o};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Pagos"}),e.jsx(j,{variant:"outline",size:"sm",disabled:!0,className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{p(null),o(!0)},children:e.jsx(k,{})}),e.jsxs("div",{className:"rounded-md border",children:[i&&e.jsx(q,{open:i,onOpenChange:o,children:e.jsxs(L,{children:[e.jsxs(B,{children:[e.jsx(I,{children:x?"Editar Pago":"Agregar Pago"}),e.jsx(O,{children:x?"Modifica los datos del pago y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo pago en el sistema."})]}),e.jsx(se,{...f})]})}),e.jsxs(V,{children:[e.jsx(X,{children:d.getHeaderGroups().map(n=>e.jsx(y,{children:n.headers.map(a=>e.jsx($,{children:a.isPlaceholder?null:D(a.column.columnDef.header,a.getContext())},a.id))},n.id))}),e.jsx(G,{className:"text-gray-600",children:(s=d.getRowModel().rows)!=null&&s.length?d.getRowModel().rows.map(n=>e.jsx(y,{onClick:()=>{p(n.original),o(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:n.getVisibleCells().map(a=>e.jsx(C,{className:"py-0.5",children:D(a.column.columnDef.cell,a.getContext())},a.id))},n.id)):e.jsx(y,{children:e.jsx(C,{colSpan:r.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const ie=[{accessorKey:"id",header:"#",cell:({row:r})=>r.index+1},{accessorKey:"facturacion_id",header:"Factura"},{accessorKey:"monto",header:"Monto del pago"},{accessorKey:"fecha_pago",header:"Fecha de pago"},{accessorKey:"metodo_pago",header:"Número de referencia"},{accessorKey:"numero_referencia_pago",header:"Medio de pago"},{accessorKey:"soporte_pago",header:"Soporte de pago"},{accessorKey:"observaciones",header:"Observaciones"}];_.defaults.withCredentials=!0;_.defaults.withXSRFToken=!0;function ge(){const{pagos:r,fetchPagos:c}=F();return v.useEffect(()=>{c()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(ne,{data:r,columns:ie})})}export{ge as default};
