import{j as e,L,b as f,r as k,B as h,d as A}from"./index-2LiSZXBZ.js";import{B as I,A as $,a as y,b as C,c as N,C as F,d as H,P as z,e as B,f as M,g as K,h as O,i as V}from"./accordion-CI16pW9i.js";import{u as Q,D as G,a as U,b as X,c as q,d as J,e as W,T as Y,f as Z,g as S,h as ee,i as T,j as ae,k as D,l as se}from"./dialog-DMjTJuR_.js";import{T as g,a as j,b}from"./tooltip-CQLOvW6r.js";import{I as re}from"./createLucideIcon-ChwpPmIM.js";import{S as ne,a as ie,b as le,c as te,d as oe,e as ce,F as R}from"./constants-BYJ4P_pl.js";import{t as P}from"./timeFormatter-DNfpeksr.js";import{c as de,P as he}from"./react-CfnTfrbB.js";import"./Combination-KtqryYF5.js";const xe=i=>[{accessorKey:"id",header:"#",cell:({row:r})=>r.index+i},{id:"acudiente",cell:({row:r})=>r.original.acudiente_id?e.jsx(I,{className:"h-5 min-w-5 rounded-full px-1 font-mono tabular-nums",variant:"secondary",asChild:!0,children:e.jsx(L,{to:"#",children:"A"})}):null},{id:"nombresCompletos",accessorFn:r=>`${r.nombres} ${r.apellidos}`,header:"Nombres completos"},{accessorKey:"edad",header:"Edad"},{accessorKey:"correo",header:"Correo electrónico"},{accessorKey:"telefono",header:"Teléfono"},{accessorKey:"sede.nombre",header:"Sede"},{id:"horario",header:"Horario",accessorFn:r=>`${r.horario.dia_semana}`}];function ue({value:i,options:r,onValueChange:s}){return e.jsxs(ne,{value:String(i),onValueChange:n=>s(n),children:[e.jsx(ie,{children:e.jsx(le,{placeholder:String(i)})}),e.jsx(te,{children:e.jsx(oe,{children:r.map(n=>e.jsx(ce,{value:String(n.value),children:n.label},String(n.value)))})})]})}const pe=async(i,r)=>{var s,n,l,t;try{return r&&(r==null?void 0:r.trim())!==""?(await f.get(`client/buscar?q=${r}`)).data:(await f.get(`client/estudiantes${"?"+i}`)).data}catch(o){const c=o,a=((n=(s=c.response)==null?void 0:s.data)==null?void 0:n.message)??"Error inesperado",u=(t=(l=c.response)==null?void 0:l.data)==null?void 0:t.errors;throw{message:a,validationErrors:u}}},me=async i=>{var r,s,n,l;try{return(await f.post("client/estudiante",i)).data}catch(t){const o=t,c=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.message)??"Error inesperado",a=(l=(n=o.response)==null?void 0:n.data)==null?void 0:l.errors;throw{message:c,validationErrors:a}}},ge=async(i,r)=>{var s,n,l,t;try{return(await f.patch(`client/estudiante/${i}`,r)).data}catch(o){const c=o,a=((n=(s=c.response)==null?void 0:s.data)==null?void 0:n.message)??"Error inesperado",u=(t=(l=c.response)==null?void 0:l.data)==null?void 0:t.errors;throw{message:a,validationErrors:u}}},je=async i=>{var r,s,n,l;try{return(await f.delete(`client/estudiante/${i}`)).data}catch(t){const o=t,c=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.message)??"Error inesperado",a=(l=(n=o.response)==null?void 0:n.data)==null?void 0:l.errors;throw{message:c,validationErrors:a}}},E=de((i,r)=>({estudiantes:[],selectedEstudiante:null,loading:!1,pagination:"",query:"",error:null,pageLinks:{first_page_url:"",last_page_url:"",next_page_url:null,prev_page_url:null},pageNumRefs:{current_page:1,last_page:1,per_page:10,from:0,to:0,total:0,next_page:null},fetchEstudiantes:async(s,n)=>{i({loading:!0,error:null});try{const l=await pe(s,n),{current_page:t,last_page:o,per_page:c,from:a,to:u,total:p,next_page:m,first_page_url:w,last_page_url:v,next_page_url:_,prev_page_url:d}=l;i({pageNumRefs:{current_page:t,last_page:o,per_page:c,from:a,to:u,total:p,next_page:m}}),i({pageLinks:{first_page_url:w,last_page_url:v,next_page_url:_,prev_page_url:d}}),i({estudiantes:l.data})}catch(l){i({error:l.message||"Error al cargar estudiantes"})}finally{i({loading:!1})}},handlePageChange:async s=>{const n=r().pageLinks;console.log(s),console.log(n);function l(t){return t.split("?")[1]}switch(s){case"first":i({pagination:l(n.first_page_url)});break;case"previous":i({pagination:l(n.prev_page_url??"")});break;case"next":i({pagination:l(n.next_page_url??"")});break;case"last":i({pagination:l(n.last_page_url??"")});break}},setQuery:s=>{i({query:s})},createEstudiante:async s=>{await me(s),await r().fetchEstudiantes()},updateEstudiante:async(s,n)=>{await ge(s,n),await r().fetchEstudiantes()},deleteEstudiante:async s=>{await je(s),await r().fetchEstudiantes()},selectEstudiante:s=>{i({selectedEstudiante:s})}}));function be({columns:i,data:r}){var _;const s=Q({data:r,columns:i,getCoreRowModel:se(),manualPagination:!0}),[n,l]=k.useState(!1),[t,o]=k.useState(),{selectEstudiante:c,selectedEstudiante:a,pageNumRefs:u,pageLinks:p,handlePageChange:m,query:w,setQuery:v}=E();return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary",children:"Listado de Estudiantes"}),e.jsxs("div",{className:"flex w-full max-w-sm justify-between my-4 gap-2",children:[e.jsx(re,{type:"search",placeholder:"Buscar",value:w,onChange:d=>v(d.target.value)}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(h,{type:"submit",variant:"outline",className:"hover:bg-primary hover:text-white",onClick:()=>v(""),children:"Limpiar"})}),e.jsx(b,{children:"Limpia la barra de búsqueda"})]}),e.jsxs(g,{children:[e.jsx(j,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end h-9 cursor-pointer",onClick:()=>{c(null),l(!0)},children:e.jsx(he,{})})}),e.jsx(b,{children:e.jsx("p",{children:"Crea un nuevo registro"})})]})]}),n&&a&&e.jsx(G,{open:n,onOpenChange:l,children:e.jsxs(U,{children:[e.jsx(X,{children:e.jsx(q,{className:"text-2xl text-left"})}),e.jsxs($,{type:"single",collapsible:!0,className:"w-full",children:[e.jsxs(y,{value:"item-1",children:[e.jsx(C,{className:"font-bold text-[16px]",children:"Detalles del Estudiante"}),e.jsxs(N,{className:"flex flex-col gap-1 text-balance",children:[e.jsxs("p",{children:[e.jsx("b",{children:"Nombres:"})," "]}),e.jsxs("p",{children:[e.jsx("b",{children:"Edad:"})," ",a.edad]}),e.jsxs("p",{children:[e.jsx("b",{children:"Documento:"})," ",a.tipo_documento," ",a.documento_identidad]}),e.jsxs("p",{children:[e.jsx("b",{children:"Correo:"})," ",a.correo]}),e.jsxs("p",{children:[e.jsx("b",{children:"Teléfono:"})," ",a.telefono]}),e.jsxs("p",{children:[e.jsx("b",{children:"Dirección:"})," ",a.direccion]}),e.jsxs("p",{children:[e.jsx("b",{children:"RUT:"})," ",a.rut??"N/A"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Acepta el reglamento:"})," ",a.acepta_reglamento?"Sí":"No"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Autoriza uso de imagen:"})," ",a.autoriza_uso_imagen?"Sí":"No"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Observaciones:"})," ",a.observaciones??"N/A"]})]})]}),a.acudiente&&e.jsxs(y,{value:"item-2",children:[e.jsx(C,{className:"font-bold text-[16px]",children:"Detalle del Acudiente"}),e.jsxs(N,{className:"flex flex-col gap-1 text-balance",children:[e.jsxs("p",{children:[e.jsx("b",{children:"Nombres:"})," ",a==null?void 0:a.acudiente.nombres," ",a==null?void 0:a.acudiente.apellidos]}),e.jsxs("p",{children:[e.jsx("b",{children:"Documento:"})," ",a==null?void 0:a.acudiente.tipo_documento," ",a==null?void 0:a.acudiente.documento_identidad]}),e.jsxs("p",{children:[e.jsx("b",{children:"Teléfono:"})," ",a==null?void 0:a.acudiente.telefono]}),e.jsxs("p",{children:[e.jsx("b",{children:"Correo:"})," ",a==null?void 0:a.acudiente.email]})]})]}),e.jsxs(y,{value:"item-3",children:[e.jsx(C,{className:"font-bold text-[16px]",children:"Detalles de la Sede"}),e.jsxs(N,{className:"flex flex-col gap-1 text-balance",children:[e.jsxs("p",{children:[e.jsx("b",{children:"Nombre:"})," ",a==null?void 0:a.sede.nombre]}),e.jsxs("p",{children:[e.jsx("b",{children:"Dirección:"})," ",(a==null?void 0:a.sede.direccion)??"N/A"]})]})]}),e.jsxs(y,{value:"item-4",children:[e.jsx(C,{className:"font-bold text-[16px]",children:"Detalles del Horario"}),e.jsxs(N,{className:"flex flex-col gap-1 text-balance",children:[e.jsxs("p",{children:[e.jsx("b",{children:"Día de la semana:"})," ",a==null?void 0:a.horario.dia_semana]}),e.jsxs("p",{children:[e.jsx("b",{children:"Hora de inicio:"})," ",P(a==null?void 0:a.horario.hora_inicio)]}),e.jsxs("p",{children:[e.jsx("b",{children:"Hora de fin:"})," ",P(a==null?void 0:a.horario.hora_fin)]})]})]})]}),e.jsxs(J,{children:[e.jsx(W,{asChild:!0,children:e.jsx(h,{variant:"outline",children:"Cancelar"})}),e.jsx(h,{type:"submit",children:"Editar"}),e.jsx(h,{variant:"destructive",type:"submit",disabled:!0,children:"Eliminar"})]})]})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Y,{children:[e.jsx(Z,{children:s.getHeaderGroups().map(d=>e.jsx(S,{children:d.headers.map(x=>e.jsx(ee,{children:x.isPlaceholder?null:T(x.column.columnDef.header,x.getContext())},x.id))},d.id))}),e.jsx(ae,{className:"text-gray-600",children:(_=s.getRowModel().rows)!=null&&_.length?s.getRowModel().rows.map(d=>e.jsx(S,{onClick:()=>{c(d.original),l(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:d.getVisibleCells().map(x=>e.jsx(D,{className:"py-0.5",children:T(x.column.columnDef.cell,x.getContext())},x.id))},d.id)):e.jsx(S,{children:e.jsx(D,{colSpan:i.length,className:"h-8 text-center",children:"No hay resultados"})})})]})}),e.jsx("div",{className:"flex flex-row justify-end items-center mb-4 sm:mb-0",children:e.jsxs("div",{className:"flex items-center justify-end py-4 space-x-1",children:[e.jsx(ue,{value:R[0].value,onValueChange:()=>{},options:R}),e.jsxs(g,{children:[e.jsx(j,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m("first"),disabled:p.prev_page_url===null,className:"hover:bg-primary hover:text-white hidden sm:block",children:e.jsx(F,{})})}),e.jsx(b,{children:"Primera página"})]}),e.jsxs(g,{children:[e.jsx(j,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m("previous"),disabled:p.prev_page_url===null,className:"hover:bg-primary hover:text-white",children:e.jsx(H,{})})}),e.jsx(b,{children:"Página anterior"})]}),e.jsx(z,{className:"hidden sm:flex mr-1",children:e.jsx(B,{children:e.jsx(M,{children:e.jsx(K,{children:u.current_page})})})}),e.jsxs(g,{children:[e.jsx(j,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m("next"),disabled:p.next_page_url===null,className:"hover:bg-primary hover:text-white",children:e.jsx(O,{})})}),e.jsx(b,{children:"Siguiente página"})]}),e.jsxs(g,{children:[e.jsx(j,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m("last"),disabled:p.next_page_url===null,className:"hover:bg-primary hover:text-white hidden sm:block",children:e.jsx(V,{})})}),e.jsx(b,{children:"Última página"})]})]})})]})}A.defaults.withCredentials=!0;A.defaults.withXSRFToken=!0;function Te(){const{fetchEstudiantes:i,estudiantes:r,pagination:s,pageNumRefs:n,query:l}=E();return k.useEffect(()=>{i(s,l)},[s,l]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(be,{columns:xe(Number(n.from)),data:r})})}export{Te as default};
