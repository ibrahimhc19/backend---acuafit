import{i as b,r as T,j as e,B as y,t as u,h as R}from"./index-D1NFy3tZ.js";import{d as I,e as k,u as z,D as P,a as K,b as O,c as B,m as G,T as U,f as X,g as _,h as q,i as F,j as J,k as H,l as Q}from"./dialog-CjM5-G6b.js";import{i as W,u as Y,A as Z,a as ee,b as re,c as ae,d as se,e as oe,f as ie,g as ne,h as te,P as le}from"./alert-dialog-ByAjfF8N.js";import{t as ce,F as de,a as x,b as p,c as g,d as j,e as f,o as he,s as C,f as N}from"./form-CQ3qu0Kr.js";import{u as me}from"./index.esm-jp6ksClY.js";import{I as $}from"./createLucideIcon-AbIisFMA.js";import{S as w,a as v,b as D,c as E,e as S}from"./select-DtuJYWZ_.js";import{T as L,D as V}from"./constants-Lyt7s15n.js";import{t as M}from"./timeFormatter-DNfpeksr.js";import"./index-CtCmacCa.js";const ue=async()=>{var a,i,s,n;try{return(await b.get("client/horarios")).data.data}catch(r){const t=r,l=((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)??"Error inesperado",h=(n=(s=t.response)==null?void 0:s.data)==null?void 0:n.errors;throw{message:l,validationErrors:h}}},xe=async a=>{var i,s,n,r;try{return(await b.post("client/horario",a)).data}catch(t){const l=t,h=((s=(i=l.response)==null?void 0:i.data)==null?void 0:s.message)??"Error inesperado",c=(r=(n=l.response)==null?void 0:n.data)==null?void 0:r.errors;throw{message:h,validationErrors:c}}},pe=async(a,i)=>{var s,n,r,t;try{return(await b.patch(`client/horario/${a}`,i)).data}catch(l){const h=l,c=((n=(s=h.response)==null?void 0:s.data)==null?void 0:n.message)??"Error inesperado",m=(t=(r=h.response)==null?void 0:r.data)==null?void 0:t.errors;throw{message:c,validationErrors:m}}},ge=async a=>{var i,s,n,r;try{return(await b.delete(`client/horario/${a}`)).data}catch(t){const l=t,h=((s=(i=l.response)==null?void 0:i.data)==null?void 0:s.message)??"Error inesperado",c=(r=(n=l.response)==null?void 0:n.data)==null?void 0:r.errors;throw{message:h,validationErrors:c}}},A=W((a,i)=>({horarios:[],selectedHorario:null,loading:!1,error:null,fetchHorarios:async()=>{a({loading:!0,error:null});try{const s=await ue();a({horarios:s})}catch(s){a({error:s.message||"Error al cargar horarios"})}finally{a({loading:!1})}},createHorario:async s=>{await xe(s),await i().fetchHorarios()},updateHorario:async(s,n)=>{await pe(s,n),await i().fetchHorarios()},deleteHorario:async s=>{await ge(s),await i().fetchHorarios()},selectHorario:s=>{a({selectedHorario:s})}})),je=he({tipo_grupo:N(L),dia_semana:N(V),hora_inicio:C().min(1,{message:"La hora de inicio es obligatoria"}),hora_fin:C().min(1,{message:"La hora de fin es obligatoria"}),sede_id:C().min(1,{message:"La dirección de la horario es obligatoria"})}).refine(a=>{const[i,s]=a.hora_inicio.split(":").map(Number),[n,r]=a.hora_fin.split(":").map(Number),t=i*60+s;return n*60+r>t},{message:"La hora de fin debe ser posterior a la hora de inicio",path:["hora_fin"]});function fe({setIsModalOpen:a}){const{sedes:i,fetchSedes:s}=Y(),{selectHorario:n,selectedHorario:r,createHorario:t,updateHorario:l,deleteHorario:h}=A();T.useEffect(()=>{i.length===0&&s()},[]);const c=me({resolver:ce(je),defaultValues:{tipo_grupo:`${(r==null?void 0:r.tipo_grupo)??""}`,dia_semana:`${(r==null?void 0:r.dia_semana)??""}`,hora_inicio:`${(r==null?void 0:r.hora_inicio)??"07:00:00"}`,hora_fin:`${(r==null?void 0:r.hora_fin)??"08:00:00"}`,sede_id:`${(r==null?void 0:r.sede_id)??""}`}}),m=async o=>{if(r!=null&&r.id)try{await l(r.id,o),u.success("La horario fue actualizada correctamente."),n(null),a(!1)}catch(d){u.error("No se pudo actualizar la horario. Intenta de nuevo."),console.error("Error al actualizar",d)}else try{await t(o),u.success("La horario fue registrada correctamente."),n(null),a(!1)}catch(d){u.error("No se pudo registrar la horario. Intenta de nuevo."),console.error("Error al registrar",d)}};return e.jsx(de,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(m),className:"space-y-4",children:[e.jsx(x,{control:c.control,name:"tipo_grupo",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Grupo"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(v,{children:e.jsx(D,{placeholder:"Tipos de grupo"})})}),e.jsx(E,{children:L.map(d=>e.jsx(S,{value:d,children:d}))})]}),e.jsx(f,{})]})}),e.jsx(x,{control:c.control,name:"dia_semana",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Día"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(v,{children:e.jsx(D,{placeholder:"Opciones de días"})})}),e.jsx(E,{children:V.map(d=>e.jsx(S,{value:d,children:d}))})]}),e.jsx(f,{})]})}),e.jsx(x,{control:c.control,name:"sede_id",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Sede"}),e.jsxs(w,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(v,{children:e.jsx(D,{placeholder:"Opciones de sedes"})})}),e.jsx(E,{children:i.map(d=>e.jsx(S,{value:d.id.toString(),children:d.nombre},d.id))})]}),e.jsx(f,{})]})}),e.jsx(x,{control:c.control,name:"hora_inicio",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Hora de inicio"}),e.jsx(j,{children:e.jsx($,{...o,type:"time",id:"time-picker",step:"1"})}),e.jsx(f,{})]})}),e.jsx(x,{control:c.control,name:"hora_fin",render:({field:o})=>e.jsxs(p,{children:[e.jsx(g,{children:"Hora de fin"}),e.jsx(j,{children:e.jsx($,{...o,type:"time",id:"time-picker",step:"1"})}),e.jsx(f,{})]})}),e.jsxs(I,{children:[e.jsx(k,{asChild:!0,children:e.jsx(y,{variant:"outline",children:"Cancelar"})}),e.jsx(y,{type:"submit",children:r?"Actualizar":"Agregar"}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:r&&e.jsx(y,{variant:"destructive",children:"Eliminar"})}),e.jsxs(re,{children:[e.jsxs(ae,{children:[e.jsx(se,{children:"¿Estás seguro?"}),e.jsx(oe,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(ie,{children:[e.jsx(ne,{children:"Cancelar"}),e.jsx(te,{onClick:async()=>{if(r!=null&&r.id)try{await h(r.id),u.success("La sede fue eliminada correctamente."),n(null),a(!1)}catch(o){u.error("No se pudo eliminar la sede. Intenta de nuevo."),console.error("Error al eliminar",o)}},children:"Confirmar"})]})]})]})]})]})})}function ye({columns:a,data:i}){var c;const s=z({data:i,columns:a,getCoreRowModel:Q(),manualPagination:!0}),[n,r]=T.useState(!1),{selectedHorario:t,selectHorario:l}=A(),h={setIsModalOpen:r};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Horarios"}),e.jsx(y,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{l(null),r(!0)},children:e.jsx(le,{})}),e.jsxs("div",{className:"rounded-md border",children:[n&&e.jsx(P,{open:n,onOpenChange:r,children:e.jsxs(K,{children:[e.jsxs(O,{children:[e.jsx(B,{children:t?"Editar Horario":"Agregar Horario"}),e.jsx(G,{children:t?"Modifica los datos del horario y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo horario en el sistema."})]}),e.jsx(fe,{...h})]})}),e.jsxs(U,{children:[e.jsx(X,{children:s.getHeaderGroups().map(m=>e.jsx(_,{children:m.headers.map(o=>e.jsx(q,{children:o.isPlaceholder?null:F(o.column.columnDef.header,o.getContext())},o.id))},m.id))}),e.jsx(J,{className:"text-gray-600",children:(c=s.getRowModel().rows)!=null&&c.length?s.getRowModel().rows.map(m=>e.jsx(_,{onClick:()=>{l(m.original),r(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:m.getVisibleCells().map(o=>e.jsx(H,{className:"py-0.5",children:F(o.column.columnDef.cell,o.getContext())},o.id))},m.id)):e.jsx(_,{children:e.jsx(H,{colSpan:a.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const be=[{accessorKey:"id",header:"#",cell:({row:a})=>a.index+1},{accessorKey:"tipo_grupo",header:"Grupo",accessorFn:a=>`${a.tipo_grupo}`},{accessorKey:"sede.nombre",header:"Sede"},{accessorKey:"dia_semana",header:"Día"},{accessorKey:"hora_inicio",header:"Hora de inicio",accessorFn:a=>`${M(a.hora_inicio)}`},{accessorKey:"hora_fin",header:"Hora de fin",accessorFn:a=>`${M(a.hora_fin)}`}];R.defaults.withCredentials=!0;R.defaults.withXSRFToken=!0;function He(){const{horarios:a,fetchHorarios:i}=A();return T.useEffect(()=>{i()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(ye,{data:a,columns:be})})}export{He as default};
