import{r as F,j as e,B as b,t as h,d as I}from"./index-C4tmSXU-.js";import{d as z,e as H,u as P,D as K,a as L,b as O,c as B,m as G,T as U,f as X,g as C,h as q,i as E,j as J,k as w,l as Q}from"./dialog-DJuDSwhf.js";import{u as N}from"./useHorariosStore-2n4kzDLJ.js";import{t as W,F as Y,a as x,b as j,c as p,d as g,e as f,o as Z,s as y,f as M}from"./form-BlLoRA9W.js";import{u as ee}from"./index.esm-DTiEesBQ.js";import{I as R}from"./createLucideIcon-B7HhsFcP.js";import{S as D,a as S,b as v,c as T,T as $,f as A,D as k}from"./select-CzNSQ8vQ.js";import{u as re,A as ae,a as se,b as oe,c as ie,d as ne,e as le,f as te,g as ce,h as de}from"./alert-dialog-rC-hXEpy.js";import{P as he}from"./plus-BvFwkRlC.js";import{t as V}from"./timeFormatter-DNfpeksr.js";import"./index-CNyQeywB.js";import"./react-CUPexu54.js";const me=Z({tipo_grupo:M($),dia_semana:M(k),hora_inicio:y().min(1,{message:"La hora de inicio es obligatoria"}),hora_fin:y().min(1,{message:"La hora de fin es obligatoria"}),sede_id:y().min(1,{message:"La dirección de la horario es obligatoria"})}).refine(s=>{const[n,c]=s.hora_inicio.split(":").map(Number),[l,r]=s.hora_fin.split(":").map(Number),d=n*60+c;return l*60+r>d},{message:"La hora de fin debe ser posterior a la hora de inicio",path:["hora_fin"]});function ue({setIsModalOpen:s}){const{sedes:n,fetchSedes:c}=re(),{selectHorario:l,selectedHorario:r,createHorario:d,updateHorario:m,deleteHorario:_}=N();F.useEffect(()=>{n.length===0&&c()},[]);const i=ee({resolver:W(me),defaultValues:{tipo_grupo:`${(r==null?void 0:r.tipo_grupo)??""}`,dia_semana:`${(r==null?void 0:r.dia_semana)??""}`,hora_inicio:`${(r==null?void 0:r.hora_inicio)??"07:00:00"}`,hora_fin:`${(r==null?void 0:r.hora_fin)??"08:00:00"}`,sede_id:`${(r==null?void 0:r.sede_id)??""}`}}),t=async a=>{if(r!=null&&r.id)try{await m(r.id,a),h.success("El horario fue actualizado correctamente."),l(null),s(!1)}catch(o){h.error("No se pudo actualizar el horario. Intenta de nuevo."),console.error("Error al actualizar",o)}else try{await d(a),h.success("El horario fue registrado correctamente."),l(null),s(!1)}catch(o){h.error("No se pudo registrar el horario. Intenta de nuevo."),console.error("Error al registrar",o)}};return e.jsx(Y,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(t),className:"space-y-4",children:[e.jsx(x,{control:i.control,name:"tipo_grupo",render:({field:a})=>e.jsxs(j,{children:[e.jsx(p,{children:"Grupo"}),e.jsxs(D,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(g,{children:e.jsx(S,{children:e.jsx(v,{placeholder:"Tipos de grupo"})})}),e.jsx(T,{children:$.map((o,u)=>e.jsx(A,{value:o,children:o},u))})]}),e.jsx(f,{})]})}),e.jsx(x,{control:i.control,name:"dia_semana",render:({field:a})=>e.jsxs(j,{children:[e.jsx(p,{children:"Día"}),e.jsxs(D,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(g,{children:e.jsx(S,{children:e.jsx(v,{placeholder:"Opciones de días"})})}),e.jsx(T,{children:k.map((o,u)=>e.jsx(A,{value:o,children:o},u))})]}),e.jsx(f,{})]})}),e.jsx(x,{control:i.control,name:"sede_id",render:({field:a})=>e.jsxs(j,{children:[e.jsx(p,{children:"Sede"}),e.jsxs(D,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(g,{children:e.jsx(S,{children:e.jsx(v,{placeholder:"Opciones de sedes"})})}),e.jsx(T,{children:n.map((o,u)=>e.jsx(A,{value:o.id.toString(),children:o.nombre},u))})]}),e.jsx(f,{})]})}),e.jsx(x,{control:i.control,name:"hora_inicio",render:({field:a})=>e.jsxs(j,{children:[e.jsx(p,{children:"Hora de inicio"}),e.jsx(g,{children:e.jsx(R,{...a,type:"time",id:"time-picker",step:"1"})}),e.jsx(f,{})]})}),e.jsx(x,{control:i.control,name:"hora_fin",render:({field:a})=>e.jsxs(j,{children:[e.jsx(p,{children:"Hora de fin"}),e.jsx(g,{children:e.jsx(R,{...a,type:"time",id:"time-picker",step:"1"})}),e.jsx(f,{})]})}),e.jsxs(z,{children:[e.jsx(H,{asChild:!0,children:e.jsx(b,{variant:"outline",children:"Cancelar"})}),e.jsx(b,{type:"submit",children:r?"Actualizar":"Agregar"}),e.jsxs(ae,{children:[e.jsx(se,{asChild:!0,children:r&&e.jsx(b,{variant:"destructive",children:"Eliminar"})}),e.jsxs(oe,{children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"¿Estás seguro?"}),e.jsx(le,{children:"Esta acción eliminará permanentemente la sede seleccionada."})]}),e.jsxs(te,{children:[e.jsx(ce,{children:"Cancelar"}),e.jsx(de,{onClick:async()=>{if(r!=null&&r.id)try{await _(r.id),h.success("El horario fue eliminado correctamente."),l(null),s(!1)}catch(a){h.error("No se pudo eliminar el horario. Intenta de nuevo."),console.error("Error al eliminar",a)}},children:"Confirmar"})]})]})]})]})]})})}function xe({columns:s,data:n}){var i;const c=P({data:n,columns:s,getCoreRowModel:Q(),manualPagination:!0}),[l,r]=F.useState(!1),{selectedHorario:d,selectHorario:m}=N(),_={setIsModalOpen:r};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"scroll-m-20 flex-wrap text-3xl font-semibold text-primary mb-8",children:"Listado de Horarios"}),e.jsx(b,{variant:"outline",size:"sm",className:"hover:bg-primary hover:text-white flex justify-self-end mb-4 cursor-pointer",onClick:()=>{m(null),r(!0)},children:e.jsx(he,{})}),e.jsxs("div",{className:"rounded-md border",children:[l&&e.jsx(K,{open:l,onOpenChange:r,children:e.jsxs(L,{children:[e.jsxs(O,{children:[e.jsx(B,{children:d?"Editar Horario":"Agregar Horario"}),e.jsx(G,{children:d?"Modifica los datos del horario y haz clic en 'Actualizar' para guardar los cambios.":"Completa la información para registrar un nuevo horario en el sistema."})]}),e.jsx(ue,{..._})]})}),e.jsxs(U,{children:[e.jsx(X,{children:c.getHeaderGroups().map(t=>e.jsx(C,{children:t.headers.map(a=>e.jsx(q,{children:a.isPlaceholder?null:E(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx(J,{className:"text-gray-600",children:(i=c.getRowModel().rows)!=null&&i.length?c.getRowModel().rows.map(t=>e.jsx(C,{onClick:()=>{m(t.original),r(!0)},className:"hover:text-muted hover:bg-primary cursor-pointer",children:t.getVisibleCells().map(a=>e.jsx(w,{className:"py-0.5",children:E(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(C,{children:e.jsx(w,{colSpan:s.length,className:"h-8 text-center",children:"No hay resultados"})})})]})]})]})}const je=[{accessorKey:"id",header:"#",cell:({row:s})=>s.index+1},{accessorKey:"tipo_grupo",header:"Grupo",accessorFn:s=>`${s.tipo_grupo}`},{accessorKey:"sede.nombre",header:"Sede"},{accessorKey:"dia_semana",header:"Día"},{accessorKey:"hora_inicio",header:"Hora de inicio",accessorFn:s=>`${V(s.hora_inicio)}`},{accessorKey:"hora_fin",header:"Hora de fin",accessorFn:s=>`${V(s.hora_fin)}`}];I.defaults.withCredentials=!0;I.defaults.withXSRFToken=!0;function Fe(){const{horarios:s,fetchHorarios:n}=N();return F.useEffect(()=>{n()},[]),e.jsx("div",{className:"container mx-auto px-6 py-4 lg:px-8 min-h-[68vh]",children:e.jsx(xe,{data:s,columns:je})})}export{Fe as default};
